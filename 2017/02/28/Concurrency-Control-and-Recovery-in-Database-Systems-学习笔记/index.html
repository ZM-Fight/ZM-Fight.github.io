<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="../../../../lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="../../../../lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="../../../../css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Concurrency Control," />








  <link rel="shortcut icon" type="image/x-icon" href="../../../../favicon.ico?v=5.1.0" />






<meta name="description" content="å­¦ä¹ ç¬”è®°ï¼šBasic two phase locking">
<meta property="og:type" content="article">
<meta property="og:title" content="Concurrency Control and Recovery in Database Systems å­¦ä¹ ç¬”è®°">
<meta property="og:url" content="http://zhoumeng.xyz/2017/02/28/Concurrency-Control-and-Recovery-in-Database-Systems-å­¦ä¹ ç¬”è®°/index.html">
<meta property="og:site_name" content="æ¢¦å·¥å‚'s blog">
<meta property="og:description" content="å­¦ä¹ ç¬”è®°ï¼šBasic two phase locking">
<meta property="og:updated_time" content="2017-03-03T03:32:41.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Concurrency Control and Recovery in Database Systems å­¦ä¹ ç¬”è®°">
<meta name="twitter:description" content="å­¦ä¹ ç¬”è®°ï¼šBasic two phase locking">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 'zm2014wangyi',
      author: 'åšä¸»'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://zhoumeng.xyz/2017/02/28/Concurrency-Control-and-Recovery-in-Database-Systems-å­¦ä¹ ç¬”è®°/"/>





  <title> Concurrency Control and Recovery in Database Systems å­¦ä¹ ç¬”è®° | æ¢¦å·¥å‚'s blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">æ¢¦å·¥å‚'s blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            é¦–é¡µ
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            å½’æ¡£
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            åˆ†ç±»
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            æ ‡ç­¾
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://zhoumeng.xyz">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="æ¢¦å·¥å‚">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="../../../../images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="æ¢¦å·¥å‚'s blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                Concurrency Control and Recovery in Database Systems å­¦ä¹ ç¬”è®°
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">å‘è¡¨äº</span>
              
              <time title="åˆ›å»ºäº" itemprop="dateCreated datePublished" datetime="2017-02-28T16:49:39+08:00">
                2017-02-28
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">åˆ†ç±»äº</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="../../../../categories/æ•°æ®åº“/" itemprop="url" rel="index">
                    <span itemprop="name">æ•°æ®åº“</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2017/02/28/Concurrency-Control-and-Recovery-in-Database-Systems-å­¦ä¹ ç¬”è®°/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          
              <div class="post-description">
                  å­¦ä¹ ç¬”è®°ï¼šBasic two phase locking
              </div>
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h3 id="chapter3"><a href="#chapter3" class="headerlink" title="chapter3"></a>chapter3</h3><h4 id="3-2-Basic-two-phase-locking"><a href="#3-2-Basic-two-phase-locking" class="headerlink" title="3.2 Basic two phase locking"></a>3.2 Basic two phase locking</h4><ol>
<li>ä¸€äº›æ¦‚å¿µ<ul>
<li>é”çš„ç›´è§‚æ¦‚å¿µ</li>
<li>é”çš„ç±»å‹ï¼Œè¯»å†™é”ï¼ŒåŠ è§£é”ï¼›</li>
<li>lock tableï¼ˆç»†èŠ‚3.6ï¼‰</li>
<li>lock conflict</li>
</ul>
</li>
<li>basic version of 2pl<ul>
<li>2plçš„ruleï¼ˆ3æ¡ï¼Œæ¯æ¡çš„æ„ä¹‰ï¼‰</li>
<li>ç¤ºä¾‹<br>  æ€è€ƒï¼š1é”è¡¨çš„ç»†èŠ‚æ•°æ®ï¼‹é”ï¼‹äº‹åŠ¡ï¼Œè¿˜è¦dmé€šçŸ¥çš„æ‰§è¡Œç»“æœï¼Ÿ<pre><code>2delayçš„queueæ˜¯æ€æ ·æ’åºçš„ï¼ŸæŒ‰ç…§æ¥å—çš„é¡ºåºè¿˜æ˜¯ç›¸åŒäº‹åŠ¡åœ¨ä¸€èµ·ï¼›
</code></pre></li>
<li>2plçš„é—®é¢˜ï¼šæ­»é”<br>  ç¤ºä¾‹1 æ•°æ®é¡¹äº¤å‰æ‰§è¡Œï¼›<br>  ç¤ºä¾‹2 é”è½¬æ¢ï¼Œè¯»é”å‡çº§æ­»é”ï¼›</li>
</ul>
</li>
</ol>
<h4 id="3-3-CORRECTNESS-OF-BASIC-TWO-PHASE-LOCKING"><a href="#3-3-CORRECTNESS-OF-BASIC-TWO-PHASE-LOCKING" class="headerlink" title="3.3 CORRECTNESS OF BASIC TWO PHASE LOCKING"></a>3.3 CORRECTNESS OF BASIC TWO PHASE LOCKING</h4><ol>
<li><p>scheduleræ­£ç¡®æ€§ï¼š</p>
<p> To prove that a scheduler is correct, we have to prove that all histories representing executions that could be produced by it are SR. </p>
</li>
<li><p>è¯æ˜è¿‡ç¨‹</p>
<p> ï¼ˆ1ï¼‰æ€»ç»“2plçš„historiesï¼Œå…·æœ‰çš„ç‰¹ç‚¹ï¼›</p>
<ul>
<li>proposition1</li>
<li>proposition2</li>
<li><p>proposition3<br>ï¼Ÿschedulerçš„historyæ˜¯ä¸€ä¸ªè¿ç»­çš„ï¼Œæµå¼çš„ï¼›æ€ä¹ˆå¯ä»¥ä¸€ä¸ªä¸ªçš„åˆ†æå‘¢ï¼Ÿ</p>
<p>ï¼ˆ2ï¼‰è¯æ˜å…·æœ‰è¿™äº›ç‰¹ç‚¹çš„historyä¸€å®šæ˜¯SRçš„ï¼Œå³SG(H)æ— ç¯ï¼›</p>
</li>
<li>step1</li>
<li>step2</li>
<li>step3</li>
</ul>
</li>
<li>æ€»ç»“<ul>
<li>lemma1</li>
<li>lemma2:æ„æ€åº”è¯¥æ˜¯xå’Œyåˆ†åˆ«ä¸ºshared dataï¼›</li>
<li>Theorem: Every 2PL history H is serializable;</li>
</ul>
</li>
</ol>
<h4 id="3-4-DEADLOCKS-æ—¢ç„¶2plæ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°±æ¥è§£å†³å®ƒçš„é—®é¢˜"><a href="#3-4-DEADLOCKS-æ—¢ç„¶2plæ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°±æ¥è§£å†³å®ƒçš„é—®é¢˜" class="headerlink" title="3.4 DEADLOCKS (æ—¢ç„¶2plæ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°±æ¥è§£å†³å®ƒçš„é—®é¢˜)"></a>3.4 DEADLOCKS (æ—¢ç„¶2plæ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°±æ¥è§£å†³å®ƒçš„é—®é¢˜)</h4><p>scheduleræ£€æµ‹deadlockçš„ç­–ç•¥ï¼š</p>
<h5 id="TimeOut"><a href="#TimeOut" class="headerlink" title="TimeOut"></a>TimeOut</h5><ol>
<li>ä»‹ç»<br> If the scheduler finds that a trans- action has been waiting too long for a lock, then it simply guesses that there may be a deadlock involving this transaction and therefore aborts it.</li>
<li>æƒè¡¡<br> The timeout period is therefore a parameter that needs to be tuned. It should be long enough so that most transactions that are aborted are actually deadlocked, but short enough that deadlocked transac- tions donâ€™t wait too long for their deadlocks to be noticed. </li>
</ol>
<h5 id="WFG-wait-for-graph"><a href="#WFG-wait-for-graph" class="headerlink" title="WFG(wait-for-graph)"></a>WFG(wait-for-graph)</h5><ol>
<li>ä»‹ç»<br> The nodes of WFG are labelled with transaction names. There is an edge Ti â€“ Tj,from node Ti to node Tj, iff transaction Ti, is waiting for transaction Tj to release some lock.</li>
<li>WFG ä¸ SGçš„åŒºåˆ«ï¼›<br> åœ¨WFGä¸­Ti -&gt; Tjï¼Œä¹Ÿæ˜¯ç›´æ¥çš„å…³ç³»è€Œä¸æ˜¯ä¼ é€’çš„å…³ç³»ï¼›</li>
<li>maintain a representation of the WFG<br> For example, suppose the scheduler receives YJx], but has to delay it because Tj already owns wl,[x]. Then it adds an edge T; + Tj to the WFG. After Tj releases w~[x], the scheduler sets rl;[x], and therefore deletes the edge Ti -+ Tja</li>
<li>æ£€æµ‹timeçš„æƒè¡¡</li>
<li>ä¸­æ–­äº‹åŠ¡é€‰æ‹©çš„å› ç´ ï¼&gt;abortion cost least<br> (1)(2)(3)(4)(5)</li>
</ol>
<h4 id="3-5-VARIATIONS-OF-TWO-PHASE-LOCKING-å˜ä½“"><a href="#3-5-VARIATIONS-OF-TWO-PHASE-LOCKING-å˜ä½“" class="headerlink" title="3.5 VARIATIONS OF TWO PHASE LOCKING å˜ä½“"></a>3.5 VARIATIONS OF TWO PHASE LOCKING å˜ä½“</h4><h5 id="Conservative-2PL-ä¿å®ˆ"><a href="#Conservative-2PL-ä¿å®ˆ" class="headerlink" title="Conservative 2PL ä¿å®ˆ"></a>Conservative 2PL ä¿å®ˆ</h5><ol>
<li>Conservative 2PL avoids deadlocks by requiring each transaction to obtain all of its locks before any of its operations are submitted to the DM. This is done by having each transaction predeclare its readset and writeset. </li>
<li>If, on the other hand, an)â€™ of the locks requested in T,â€˜s Start conflicts with<br>locks presently held by other transactions, then the scheduler does not grant any of T,â€˜s locks.</li>
<li>Since deadlock is the only reason that a 2PL scheduler ever rejects an operation and thereby causes the corresponding transaction to abort, Conservative 2PL never aborts a transaction. </li>
</ol>
<h5 id="Strict-2PL"><a href="#Strict-2PL" class="headerlink" title="Strict 2PL"></a>Strict 2PL</h5><ol>
<li>ä»‹ç»<br>almost all implementations of 2PL use a variant called Strict 2PL. This differs from the Basic 2PL scheduler described in Section 3.2 in that it requires the scheduler to release all of a transactionâ€™s locks together, when the transaction terminates. More specifically, Tls locks are released after the DM acknowl- edges the processing of ci or ajã€‚</li>
<li><p>ä½¿ç”¨çš„åŸå› </p>
<ul>
<li>é‡Šæ”¾é”çš„æ—¶é—´ç‚¹</li>
<li>ä¿è¯ä¸¥æ ¼æ‰§è¡Œ ï¼ˆp35 ä¸¥æ ¼æ¨¡å¼å®šä¹‰ï¼‰</li>
</ul>
</li>
<li><p>å…¶ä»–</p>
<ul>
<li>read lock/write lock çš„é‡Šæ”¾æ—¶é—´</li>
<li>ä¸¥æ ¼æ¨¡å¼å¥½å¤„å¤šå¤šï¼Œ2PL implementations usually take the form of Strict 2PL schedulers, rather than the seemingly more flexible Basic 2PL schedulers.<br>(æ¯”å¦‚Basic 2PLï¼šw1(x)-&gt;c1(x)scheduleræ”¶åˆ°é€šçŸ¥ï¼Œwu1(x),dmä¹‹è¡Œï¼›w2(x),è¿™æ—¶äº‹åŠ¡1å‡ºé”™éœ€è¦abort;ä½†æ˜¯å®ƒçš„å€¼å·²ç»è¢«æ”¹å†™äº†ï¼Œæ€ä¹ˆæ¢å¤å‘¢ï¼Ÿä¸èƒ½ä¿è¯ä¸¥æ ¼æ¨¡å¼)</li>
</ul>
</li>
</ol>
<h4 id="3-6-IMPLEMENTATION-ISSUES"><a href="#3-6-IMPLEMENTATION-ISSUES" class="headerlink" title="3.6 IMPLEMENTATION ISSUES"></a>3.6 IMPLEMENTATION ISSUES</h4><ol>
<li><p>æ¨¡å‹çš„å˜åŒ–ï¼ˆTM+LM+DMï¼‰</p>
<p> The scheduler abstraction is usually implemented by a combination of a lock manager (LM) and a TM. The LM services the Lock and Unlock opera- tions. When the TM receives a Read or Write from a transaction, it sends the appropriate Lock operation to the LM. When the LM acknowledges that the lock is set, the TM sends the Read or Write to the DM. Thus, the TM subsumes the scheduler function of ensuring that a lock is set before the corre- sponding operation is performed.</p>
</li>
<li><p>The Lock Manager</p>
<p> The LM maintains a table of locks, and supports the operations Lock(trans- action-id, data-item, mode) and Unlock(transaction-id, data-item).</p>
<p> To process a Lock operation, the LM tries to set the specified lock by adding an entry to the lock table. If another transaction owns a conflicting lock, then the LM adds the lock request to a queue of waiting requests for that data item.5 Unlock releases the specified lock, and grants any waiting lock requests that are no longer blocked.</p>
<p> é€šè¿‡è¡¨é¡¹æ¥å®ç°â€œé”â€æ•°æ®ï¼Œè€Œä¸æ˜¯çœŸæœ‰ä¸ªé”åœ¨é‚£ï¼›</p>
<p> é”è¡¨çš„å…·ä½“å®ç°ï¼š<br> The lock table is usually implemented as a hash table with the data item identifier as keyï¼›<br> An entry in the table for data item x contains a queue header, which points to a list of locks on x that have been set and a list of lock requests that are waiting.<br> Since a very large number of data items can potentially be locked, the LM limits the size of the lock table by only allocating entries for those data items that actually are locked. When it releases the last lock for a data item X, it deallocates the entry for X.</p>
<p> ä¼˜åŒ–åŠ é”è§£é”ï¼šLock and Unlock operations are invoked very frequentlyã€‚<br> To make these operations fast, a common practice is to link together in the lock table all of the read lock entries and all of the write lock entries of each transac- tion.<br> release write and read locks after the Commit. </p>
<p> The lock table should be protected. </p>
</li>
<li><p>Blocking and Aborting Transactions</p>
<ul>
<li>ç­‰å¾…queueä¸­åˆ†é…lockçš„ç­–ç•¥ï¼š1 first-in-first-out 2 wait time </li>
<li>Blockingçš„å®ç°ï¼šä¾èµ–å…·ä½“ç³»ç»Ÿ</li>
<li>Abortingçš„å®ç°ï¼šä¾èµ–å…·ä½“ç³»ç»Ÿ<br>questionï¼š è°æ¥è´Ÿè´£æ£€æµ‹æ­»é”ï¼Ÿ</li>
</ul>
</li>
<li><p>Atomicity of Reads and Writes</p>
<ul>
<li>lock table è®¿é—®çš„åŒæ­¥æ§åˆ¶ï¼›</li>
<li>ç£ç›˜çš„è®¿é—®æ§åˆ¶ï¼›</li>
</ul>
</li>
</ol>
<h4 id="3-7-THE-PHANTOM-PROBLEM"><a href="#3-7-THE-PHANTOM-PROBLEM" class="headerlink" title="3.7 THE PHANTOM PROBLEM"></a>3.7 THE PHANTOM PROBLEM</h4><ol>
<li>å…³äºå¹»è¯»çš„é—®é¢˜ï¼›</li>
<li>index lockingï¼›</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">q: ä»€ä¹ˆæ—¶å€™æ˜¯scanï¼Œä»€ä¹ˆæ—¶å€™åªæ˜¯å•ä¸ªè¯»ï¼Œç²’åº¦æ˜¯æ€ä¹ˆæ¥ç¡®å®šçš„ï¼Ÿ</div><div class="line">qï¼šäº†è§£ä¸€ä¸‹indexçš„å…·ä½“å®ç°ï¼›</div></pre></td></tr></table></figure>
<h4 id="3-8-LOCKING-ADDlTlONAL-OPERATiONS-æ‰©å……æ“ä½œç±»å‹"><a href="#3-8-LOCKING-ADDlTlONAL-OPERATiONS-æ‰©å……æ“ä½œç±»å‹" class="headerlink" title="3.8 LOCKING ADDlTlONAL OPERATiONS (æ‰©å……æ“ä½œç±»å‹)"></a>3.8 LOCKING ADDlTlONAL OPERATiONS (æ‰©å……æ“ä½œç±»å‹)</h4><ol>
<li>èƒŒæ™¯hot spots<br> Since Increment and Decrement commute, they can set weaker locks than Write operations, which do not commute. </li>
<li>conflictçš„æœ¬è´¨ï¼šæ˜¯å¦commute<br> Decrement(x, vale)] produces exactly the same result as the sequence [Decrement(x, valD), Increment(x, vail)]. That is, each operation returns the same result (i.e., nothing) and the two operations leave x in the same final state, independent of the order in which they execute. </li>
<li>æ“ä½œçš„åŸå­æ€§<br> This technique requires that Increment(x) and Decrement(x) be imple- mented atomically.<br> Thus, while an Increment or Decrement is operating on a data item, the data item is effectively locked (against any other oper- ations on that data item). This lock is only held for the duration of the Increment or Decrement operation. Once the operation is completed, this lock can be released. However, the increment or decrement lock must be held until the transaction commits to satisfy the two phase rule and strictness.</li>
<li>ä¿è¯generalized form of 2PL works correctlyæ­£ç¡®æ€§ï¼š<br> So, we can easily add new operation types by following these simple rules:<ol>
<li>Ensure that the implementation of each new operation type is atomic with respect to all other operation types.</li>
<li>Define a lock type for each new operation type.</li>
<li>Define a compatibility matrix for the lock types (for both the old and new operations) so that two lock types conflict iff the corresponding operation types on the same data item do not commute. </li>
</ol>
</li>
</ol>
<h4 id="3-9-MULTIGRANULARITY-LQCKlNG"><a href="#3-9-MULTIGRANULARITY-LQCKlNG" class="headerlink" title="3.9 MULTIGRANULARITY LQCKlNG"></a>3.9 MULTIGRANULARITY LQCKlNG</h4><ol>
<li>ä»‹ç»granularity<br> The granularity of a data item refers to that itemâ€™s relative size.<br> The granularity of data items is unimportant as far as correctness is concerned. The granularity is important, however, when it comes to perfor- mance.<br> Selecting a granularity for locks requires striking a balance between lock- ing overhead and amount of concurrency. </li>
<li><p>MGL</p>
<ol>
<li><p>ä»‹ç»<br>We can do even better than choosing a uniform â€œoptimalâ€ granule size for all data items by means of multigrandarit~ locking (MGL).<br>MGL allows each transaction to use granule sizes most appropriate to its mode of operation. </p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">qï¼šä¸€ä¸ªäº‹åŠ¡ä¸€ä¸ªç²’åº¦è¿˜æ˜¯ä¸€ä¸ªæ“ä½œä¸€ä¸ªç²’åº¦ï¼Ÿ</div><div class="line">	ä¸€ä¸ªäº‹åŠ¡ï¼›</div></pre></td></tr></table></figure>
</li>
<li><p>å®ç°<br>MGL requires an LM that prevents two transactions from setting conflicting locks on two granules that overlap.<br>ä¸€ä¸ªé—®é¢˜ï¼š<br>An unsatisfactory solution would be to require that the long transaction look at each record of the file to find out whether it may lock the file. This would defeat the very purpose of locking at coarse granularity - namely, to reduce locking overhead.<br>è§£å†³æ–¹æ³•ï¼š<br>A better solution is possible by exploiting the natural hierarchical relation ship between locks of different granularity.<br>lock type graph<br>lock instance graph<br>A set of data items that is structured according to a lock type graph is called a lock instance graph (see Fig. 3-4). The graph represents an abstract structure that is used only by the scheduler to manage locks of different granularities. It need not correspond to the physical structure of the data items themselves.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qï¼šé‚£ä¹ˆå®é™…ä¸Šæ˜¯æ€ä¹ˆç»„ç»‡çš„ï¼Ÿ è¿˜æ˜¯ä¸æ˜¯å‰è¾¹è¯´çš„hashè¡¨å’Œqueueï¼Ÿ</div></pre></td></tr></table></figure>
<p>ï¼ˆ1ï¼‰Then a lock on a coarse granule x explicitly locks x and implicitly locks all of xâ€™s proper descendants, which are finer granules â€œcontained inâ€ x. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">qï¼šä¸ºä»€ä¹ˆè¦ç»™åä»£åŠ é”ï¼Ÿ</div></pre></td></tr></table></figure>
<p>ï¼ˆ2ï¼‰It is also necessary to propagate the effects of fine granule locking activity to the coarse granules that â€œcontainâ€ them. To do this, each lock type has an associated intention lock type. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ç›®çš„ï¼šç»†çå‘ä¸Šä¼ é€’ï¼Œå½“æˆ‘æƒ³åŠ ä¸€ä¸ªå¤§é”çš„æ—¶å€™ï¼Œå¯ä»¥çŸ¥é“ä¸‹è¾¹å·²ç»æœ‰å°é”äº†ï¼Œè€Œä¸ç”¨å»ä¸€ä¸ªä¸ªæŸ¥è¯¢ï¼›</div></pre></td></tr></table></figure>
</li>
<li><p>MGLè§„åˆ™ï¼š<br>For a given lock instance graph G that is a tree, the scheduler sets and releases locks for each transaction T, according to the following MGL pro- tocol:</p>
</li>
<li>If x is not the root of G, then to set rl,[x] or irl,[x], T, must have an ir or iw lock on xâ€™s parent.</li>
<li>If x is not the root of G, then to set wl,[x] or iwl,[x], T, must have an iw lock on xâ€™s parent.</li>
<li>To read (or write) x, T, must own an r or w (or w) lock on some ances- tor of x. A lock on x itself is an explicit lock for x; a lock on a proper ancestor of x is an implicit lock for x.</li>
<li>A transaction may not release an intention lock on a data item X, if it is currently holding a lock on any child of x.<br>This implicit locking relieves a transaction from having to set explicit locks on xâ€™s descendants, which is the main reason for MGL.<br>ä¸€ä¸ªğŸŒ°ï¼›</li>
</ol>
</li>
<li><p>MGLçš„æ­£ç¡®æ€§<br> The goal of the MGL protocol is to ensure that transactions never hold conflicting (explicit or implicit) locks on the same data item;<br> Theorem 3.7: Suppose all transactions obey the MGL protocol with respect to a given lock instance data graph, G, that is a tree. If a transac- tion owns an explicit or implicit lock on a node of G, then no other trans- action owns a conflicting explicit or implicit lock on that node.</p>
</li>
<li><p>Implementation Issues</p>
<ol>
<li>2PL+MGL<br>One way of framing the relationship between these two techniques is to say that 2PL gives rules for when to lock and unlock data items. </li>
<li><p>LM<br>The LM need not know about the lock type graph, the lock instance graph, the MGL protocol, or implicit locks. Its only new feature is that it handIes more lock types (namely, intention locks) using the expanded compatibility matrix.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Q: TMä¼šä¼ é€’æ‰€æœ‰éœ€è¦åŠ é”çš„æ•°æ®ï¼Œxé”ï¼Œçˆ¶äº²é”ï¼Ÿ</div><div class="line">   è¿˜æ˜¯tmä¼ é€’xé”ï¼Œtmè‡ªåŠ¨ç»™çˆ¶äº²åŠ é”ï¼Ÿ å¥½åƒæ˜¯ç¬¬ä¸€ç§ï¼›</div></pre></td></tr></table></figure>
</li>
<li><p>é”è½¬æ¢</p>
</li>
</ol>
<ul>
<li>é”çš„å¼ºåº¦<br>To simplify this lock conversion activ- ity, it is helpful to define the strength of lock types: lock type p is stronger than lock type 4 if for every lock type o, oli[x] conflicts with ql,[x] implies that ol,[x] conflicts with p&amp;[x]. </li>
<li>é”è½¬æ¢(lock conversion table)<br>If a transaction owns p&amp;[x] and requests ql,[x], then the LM should convert pl,[x] into a lock type that is at least as strong as both p and q, </li>
</ul>
</li>
<li>Lock Escalation<br> é—®é¢˜ï¼š<br> A system that employs MGL must decide the level of granularity at which a given transaction should be locking data items.<br> è§£å†³ï¼šEscalation<br> In this case, transactions start locking items of fine granularity (e.g., records). If a transaction obtains more than a certain number of locks of a given granularity, then the scheduler starts requesting locks at the next higher level of granularity (e.g., files), that is, it escalates the granularity of the locks it requests. The scheduler may escalate the granularity of a trans- actionâ€™s lock requests more than once.<br> æ­»é”çš„é—®é¢˜ä¾ç„¶ä¼šå­˜åœ¨ï¼š<br> In some applications, lock escalations have a high probability of leading to lock conversions that cause deadlocks.<br> åº”å¯¹ï¼š<br> Instead, if a transaction gets too many fine granularity locks, it should be aborted and restarted, setting coarser granularity locks in its second incarnation. </li>
<li>Generalized Locking Graphï¼šdag Directed Acyclic Graphæœ‰å‘æ— ç¯å›¾<br> åŸæ¥çš„lock type graphæ˜¯treeçš„ç±»å‹ï¼›<br> å¦‚æœä½¿ç”¨indexï¼Œå¯ä»¥æ¨å¹¿ä¸ºDirected Acyclic Graphï¼›<br> For a given lock instance graph G that is a dag, the scheduler sets and releases locks for each transaction Ti as follows:<ol>
<li>If x is not the root of G, then to set rl;[x] or irli[x], Ti must have an ir or iw lock on some parent of X.</li>
<li>If x is not the root of G, then to set w&amp;[x] or iwli[x], Ti must have an iw lock on all of xâ€™s parents.</li>
<li>To read x, Ti must own an r or w lock on some ancestor of x. To write x, Ti must own, for every path from the root of Gto x, aw lock for some ancestor of x along that path (i.e., it may own different locks for different paths). A lock on x itself is an explicit lock for X; locks on proper ancestors of x are implicit locks for X.</li>
<li>A transaction may not release an intention lock on a data item x if it is currently holding a lock on any child of x.<pre><code>åº”è¯¥è¯»ä¸€æœ¬æ•°æ®åº“å†…æ ¸æ–¹é¢çš„ä¹¦ï¼Œäº†è§£å…·ä½“çš„å®ç°ï¼Œç°åœ¨åªæ˜¯æ¦‚å¿µä¸Šçš„äº†è§£ï¼Œæœ‰äº›å›°æƒ‘éœ€è¦å®é™…çš„å®ç°æ¥è§£å†³ï¼›
</code></pre></li>
</ol>
</li>
</ol>
<h4 id="3-10-DlSTRlBUTED-TWO-PHASE-LOCKlNG"><a href="#3-10-DlSTRlBUTED-TWO-PHASE-LOCKlNG" class="headerlink" title="3.10 DlSTRlBUTED TWO PHASE LOCKlNG"></a>3.10 DlSTRlBUTED TWO PHASE LOCKlNG</h4><ol>
<li>åˆ†å¸ƒå¼äº‹åŠ¡æµç¨‹ï¼š<br> A transaction submits its operations to a TM. The TM then delivers each Read(x) or Write(x) operation of that transaction to the scheduler that manages 3~.When (and if) a scheduler decides to process the Read(x) or Write(x), it sends the operation to its local DM, which can accessx and return its value (for a Read) or update it (for a Write). The Commit or Abort opera- tion is sent to all sites where the transaction accessed data items.</li>
<li>ç›®æ ‡ï¼š<br> The schedulers at all sites, taken together, constitute a distributed sched- uler. The task of the distributed scheduler is to process the operations submit- ted by the TMs in a (globally) serializable and recoverable manner.</li>
<li>åŸºäº2plçš„åˆ†å¸ƒå¼è°ƒåº¦å™¨ï¼š<ol>
<li>å°é—®é¢˜ï¼š<br> To enforce the two phase rule, a scheduler cannot release a transaction Tlâ€™s lock until it knows that T, wiI1 not submit any more operations to it OY any other scheduler. </li>
<li>è§£å†³ï¼šStrict 2PL</li>
<li>å…³é”®é—®é¢˜ï¼š<br> å…³äºåŸå­æ€§æäº¤é—®é¢˜ï¼šchapter7</li>
</ol>
</li>
</ol>
<h4 id="3-11-DISTRMJTED-DEADLOCK"><a href="#3-11-DISTRMJTED-DEADLOCK" class="headerlink" title="3.11 DISTRMJTED DEADLOCK"></a>3.11 DISTRMJTED DEADLOCK</h4><ol>
<li><p>åˆ†å¸ƒå¼æ­»é”çš„ç¤ºä¾‹ ğŸŒ°</p>
</li>
<li><p>è§£å†³æ–¹æ³•ï¼š</p>
<ol>
<li><p>global deadlock detection</p>
<ul>
<li>åŸç†ï¼š<br>  A simple way to do this is for each scheduler to send changes to its WFG, to a special process, the global deadlock detector. The global deadlock detector keeps the latest copy of the local WFG that it has received from each scheduler. It periodically takes the union of these local WFGs to produce a global WFG, and checks it for cycles.</li>
<li>é—®é¢˜ï¼šå‘¨æœŸæ€§æ£€æµ‹ï¼Œåˆ†å¸ƒå¼ä¸‹delayä¼šä¸¥é‡ï¼›</li>
<li>ç‰ºç‰²è€…çš„é€‰æ‹©éœ€è¦é¢å¤–çš„ä¿¡æ¯ï¼špiggybackingå‡å°‘æ¶ˆæ¯å¼€é”€<br>  Since communication cost is generally a function of the number of messages exchanged (as well as the amount of information), reducing the number of messages in this way can significantly reduce communication cost.<br>  <code>q: æ¶ˆæ¯å¼€é”€ä¸æ¶ˆæ¯ä¸ªæ•°ï¼Œæ¶ˆæ¯é•¿åº¦çš„å…³ç³»ï¼Ÿ</code></li>
</ul>
</li>
<li><p>Path pushing<br> <code>ä¸å¤ªæ˜</code></p>
</li>
<li>imestamp-based Deadlock Prevention</li>
</ol>
</li>
<li><p>Comparing Deadlock Management Techniques</p>
<p> Each approach to deadIock management has its proponents. Many centralized DBSs, such as IBMâ€™s DB2 and RTIâ€™s INGRES, use WFG cycle detection. Each of the distributed techniques we have described is implemented in a commer- cial product, and each putatively works well: Tandem uses timeout; Distrib- uted INGRES uses centralized deadlock detection; IBMâ€™s System R* prototype uses path pushing; and GEâ€™s MADMAN uses timestamp-based prevention.</p>
</li>
</ol>
<h4 id="3-12-LOCKING-PERFORMANCE"><a href="#3-12-LOCKING-PERFORMANCE" class="headerlink" title="3.12 LOCKING PERFORMANCE"></a>3.12 LOCKING PERFORMANCE</h4><p><code>æ²¡ç»†çœ‹</code></p>
<h4 id="3-13-TREE-LOCKING"><a href="#3-13-TREE-LOCKING" class="headerlink" title="3.13 TREE LOCKING"></a>3.13 TREE LOCKING</h4><p><code>æ²¡ç»†çœ‹</code></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="../../../../tags/Concurrency-Control/" rel="tag"># Concurrency Control</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="../Cousera-Machine-Learning-å­¦ä¹ ç¬”è®°2/" rel="next" title="Cousera Machine Learning å­¦ä¹ ç¬”è®°2">
                <i class="fa fa-chevron-left"></i> Cousera Machine Learning å­¦ä¹ ç¬”è®°2
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="../../../03/01/é˜…è¯»ï¼šæŠ€æœ¯æ–‡ç« /" rel="prev" title="é˜…è¯»ï¼šæŠ€æœ¯æ–‡ç« ">
                é˜…è¯»ï¼šæŠ€æœ¯æ–‡ç«  <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        <div class="ds-share flat" data-thread-key="2017/02/28/Concurrency-Control-and-Recovery-in-Database-Systems-å­¦ä¹ ç¬”è®°/"
     data-title="Concurrency Control and Recovery in Database Systems å­¦ä¹ ç¬”è®°"
     data-content=""
     data-url="http://zhoumeng.xyz/2017/02/28/Concurrency-Control-and-Recovery-in-Database-Systems-å­¦ä¹ ç¬”è®°/">
  <div class="ds-share-inline">
    <ul  class="ds-share-icons-16">

      <li data-toggle="ds-share-icons-more"><a class="ds-more" href="javascript:void(0);">åˆ†äº«åˆ°ï¼š</a></li>
      <li><a class="ds-weibo" href="javascript:void(0);" data-service="weibo">å¾®åš</a></li>
      <li><a class="ds-qzone" href="javascript:void(0);" data-service="qzone">QQç©ºé—´</a></li>
      <li><a class="ds-qqt" href="javascript:void(0);" data-service="qqt">è…¾è®¯å¾®åš</a></li>
      <li><a class="ds-wechat" href="javascript:void(0);" data-service="wechat">å¾®ä¿¡</a></li>

    </ul>
    <div class="ds-share-icons-more">
    </div>
  </div>
</div>
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2017/02/28/Concurrency-Control-and-Recovery-in-Database-Systems-å­¦ä¹ ç¬”è®°/"
           data-title="Concurrency Control and Recovery in Database Systems å­¦ä¹ ç¬”è®°" data-url="http://zhoumeng.xyz/2017/02/28/Concurrency-Control-and-Recovery-in-Database-Systems-å­¦ä¹ ç¬”è®°/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            æ–‡ç« ç›®å½•
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            ç«™ç‚¹æ¦‚è§ˆ
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="../../../../images/avatar.png"
               alt="æ¢¦å·¥å‚" />
          <p class="site-author-name" itemprop="name">æ¢¦å·¥å‚</p>
           
              <p class="site-description motion-element" itemprop="description">A goal is a dream with a deadline!</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="../../../../archives">
                <span class="site-state-item-count">17</span>
                <span class="site-state-item-name">æ—¥å¿—</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-categories">
              <a href="../../../../categories/">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">åˆ†ç±»</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="../../../../tags">
                <span class="site-state-item-count">11</span>
                <span class="site-state-item-name">æ ‡ç­¾</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/u/3063931872" target="_blank" title="å¾®åš">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  å¾®åš
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/u/6e7c82da2a5e" target="_blank" title="ç®€ä¹¦">
                  
                    <i class="fa fa-fw fa-chain"></i>
                  
                  ç®€ä¹¦
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#chapter3"><span class="nav-number">1.</span> <span class="nav-text">chapter3</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-Basic-two-phase-locking"><span class="nav-number">1.1.</span> <span class="nav-text">3.2 Basic two phase locking</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-CORRECTNESS-OF-BASIC-TWO-PHASE-LOCKING"><span class="nav-number">1.2.</span> <span class="nav-text">3.3 CORRECTNESS OF BASIC TWO PHASE LOCKING</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-DEADLOCKS-æ—¢ç„¶2plæ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°±æ¥è§£å†³å®ƒçš„é—®é¢˜"><span class="nav-number">1.3.</span> <span class="nav-text">3.4 DEADLOCKS (æ—¢ç„¶2plæ˜¯æ­£ç¡®çš„ï¼Œé‚£ä¹ˆå°±æ¥è§£å†³å®ƒçš„é—®é¢˜)</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#TimeOut"><span class="nav-number">1.3.1.</span> <span class="nav-text">TimeOut</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#WFG-wait-for-graph"><span class="nav-number">1.3.2.</span> <span class="nav-text">WFG(wait-for-graph)</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-5-VARIATIONS-OF-TWO-PHASE-LOCKING-å˜ä½“"><span class="nav-number">1.4.</span> <span class="nav-text">3.5 VARIATIONS OF TWO PHASE LOCKING å˜ä½“</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Conservative-2PL-ä¿å®ˆ"><span class="nav-number">1.4.1.</span> <span class="nav-text">Conservative 2PL ä¿å®ˆ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Strict-2PL"><span class="nav-number">1.4.2.</span> <span class="nav-text">Strict 2PL</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-IMPLEMENTATION-ISSUES"><span class="nav-number">1.5.</span> <span class="nav-text">3.6 IMPLEMENTATION ISSUES</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-7-THE-PHANTOM-PROBLEM"><span class="nav-number">1.6.</span> <span class="nav-text">3.7 THE PHANTOM PROBLEM</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-8-LOCKING-ADDlTlONAL-OPERATiONS-æ‰©å……æ“ä½œç±»å‹"><span class="nav-number">1.7.</span> <span class="nav-text">3.8 LOCKING ADDlTlONAL OPERATiONS (æ‰©å……æ“ä½œç±»å‹)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-9-MULTIGRANULARITY-LQCKlNG"><span class="nav-number">1.8.</span> <span class="nav-text">3.9 MULTIGRANULARITY LQCKlNG</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-10-DlSTRlBUTED-TWO-PHASE-LOCKlNG"><span class="nav-number">1.9.</span> <span class="nav-text">3.10 DlSTRlBUTED TWO PHASE LOCKlNG</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-11-DISTRMJTED-DEADLOCK"><span class="nav-number">1.10.</span> <span class="nav-text">3.11 DISTRMJTED DEADLOCK</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-12-LOCKING-PERFORMANCE"><span class="nav-number">1.11.</span> <span class="nav-text">3.12 LOCKING PERFORMANCE</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-13-TREE-LOCKING"><span class="nav-number">1.12.</span> <span class="nav-text">3.13 TREE LOCKING</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2015 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">æ¢¦å·¥å‚</span>
</div>



        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="../../../../lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="../../../../lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="../../../../lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="../../../../lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="../../../../lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="../../../../lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="../../../../js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="../../../../js/src/motion.js?v=5.1.0"></script>



  
  


  <script type="text/javascript" src="../../../../js/src/affix.js?v=5.1.0"></script>

  <script type="text/javascript" src="../../../../js/src/schemes/pisces.js?v=5.1.0"></script>



  
  <script type="text/javascript" src="../../../../js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="../../../../js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="../../../../js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"zm2014wangyi"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
      
      <script src="../../../../lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
      <script src="../../../../js/src/hook-duoshuo.js?v=5.1.0"></script>
    
    
    <script src="../../../../lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="../../../../js/src/hook-duoshuo.js"></script>
  













  
  

  

  

  

  


  

</body>
</html>
